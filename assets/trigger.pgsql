CREATE OR REPLACE FUNCTION PUBLIC.NOTIFYCONFIRMED() RETURNS trigger AS $BODY$ BEGIN PERFORM pg_notify('thesis_confirmed_deposit', row_to_json(NEW)::text); RETURN new; END; $BODY$ LANGUAGE 'plpgsql' VOLATILE COST 100;
CREATE OR REPLACE TRIGGER tr_deposit_confirmed AFTER UPDATE OF confirmed ON "Deposit" FOR EACH ROW WHEN (NEW.confirmed IS TRUE) EXECUTE FUNCTION PUBLIC.NOTIFYCONFIRMED();